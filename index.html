<!DOCTYPE html>
<html>
  <head>
    <title>Saling Follow Mahasiswa</title>
    <style>
      /* Modern Variables */
      :root {
        --primary: #4361ee;
        --primary-light: #4895ef;
        --secondary: #3f37c9;
        --accent: #f72585;
        --light: #f8f9fa;
        --dark: #212529;
        --success: #4cc9f0;
        --shadow: rgba(0, 0, 0, 0.1);
        --border-radius: 8px;
        --transition: all 0.3s ease;
      }

      /* Base Styling */
      body {
        font-family: "Poppins", -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: #f5f7fa;
        color: var(--dark);
        line-height: 1.6;
        padding: 2rem;
        max-width: 1000px;
        margin: 0 auto;
      }

      h2,
      h3 {
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--secondary);
        position: relative;
        display: inline-block;
      }

      h2::after,
      h3::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: -5px;
        width: 50%;
        height: 3px;
        background: linear-gradient(
          to right,
          var(--primary),
          var(--primary-light)
        );
        border-radius: 3px;
        transition: var(--transition);
      }

      h2:hover::after,
      h3:hover::after {
        width: 100%;
      }

      /* Form Elements */
      input[type="text"] {
        width: 100%;
        padding: 12px 15px;
        margin-bottom: 1rem;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
        font-size: 1rem;
        transition: var(--transition);
        background-color: var(--light);
        box-shadow: 0 2px 4px var(--shadow);
      }

      input[type="text"]:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        outline: none;
        transform: translateY(-2px);
      }

      input[type="text"]::placeholder {
        color: #adb5bd;
        opacity: 0.8;
      }

      button {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        transition: var(--transition);
        box-shadow: 0 4px 6px rgba(67, 97, 238, 0.3);
        margin-bottom: 2rem;
        display: block;
        width: 100%;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(67, 97, 238, 0.4);
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--primary)
        );
      }

      button:active {
        transform: translateY(1px);
      }

      /* User List Styling */
      #userList,
      #leaderboardList {
        background-color: white;
        border-radius: var(--border-radius);
        padding: 1.5rem;
        box-shadow: 0 5px 15px var(--shadow);
        margin-bottom: 2rem;
        min-height: 100px;
      }

      /* Leaderboard Specific */
      .leaderboard {
        position: relative;
      }

      .leaderboard::before {
        content: "üèÜ";
        position: absolute;
        top: -25px;
        right: 10px;
        font-size: 24px;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      /* User Entry Animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive Design */
      @media (min-width: 768px) {
        .form-container {
          display: grid;
          grid-template-columns: 1fr 1fr 1fr;
          gap: 1rem;
        }

        button {
          margin-top: 1rem;
          grid-column: span 3;
        }
      }

      /* Dynamic User Entry Styling */
      .user-entry {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
        border-left: 3px solid var(--primary);
        background-color: #f8f9fc;
        margin-bottom: 10px;
        border-radius: 4px;
        animation: fadeIn 0.5s ease forwards;
        transition: var(--transition);
      }

      .user-entry:hover {
        transform: translateX(5px);
        background-color: #eef2ff;
      }

      .leaderboard-entry {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        margin-bottom: 10px;
        border-radius: 4px;
        animation: fadeIn 0.5s ease forwards;
        transition: var(--transition);
        background: linear-gradient(to right, #ffffff, #f5f7ff);
        box-shadow: 0 2px 4px var(--shadow);
      }

      .leaderboard-entry:nth-child(1) {
        border-left: 4px solid gold;
        background: linear-gradient(to right, #fff9e6, #fffdf5);
      }

      .leaderboard-entry:nth-child(2) {
        border-left: 4px solid silver;
        background: linear-gradient(to right, #f5f5f5, #fdfdfd);
      }

      .leaderboard-entry:nth-child(3) {
        border-left: 4px solid #cd7f32; /* bronze */
        background: linear-gradient(to right, #faf3e0, #fdfaf5);
      }

      .rank {
        font-weight: bold;
        color: var(--primary);
        margin-right: 15px;
      }

      .username {
        font-weight: 500;
      }

      .score {
        font-weight: bold;
        color: var(--accent);
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary-light);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary);
      }
    </style>
  </head>
  <body>
    <h2>Form Registrasi</h2>
    <input type="text" id="nama" placeholder="Nama Lengkap" />
    <input type="text" id="ig" placeholder="Username Instagram" />
    <input type="text" id="tiktok" placeholder="Username TikTok" />
    <button onclick="register()">Daftar</button>

    <h3>Daftar Mahasiswa</h3>
    <div id="userList"></div>

    <h3>Leaderboard - Siapa Paling Aktif Follow</h3>
    <div class="leaderboard" id="leaderboardList"></div>

    <script>
      const sheetURL =
        "https://script.google.com/macros/s/AKfycbyVYcmGn3SpPlwwM6B08e2YwQ5Rhqlh6w-19cJsNcibscrzfuNmEue1B1zd-cTzj5SIbw/exec"; // Ganti sesuai Web App kamu
      let currentNama = "";

      function register() {
        const nama = document.getElementById("nama").value;
        const instagram = document.getElementById("ig").value;
        const tiktok = document.getElementById("tiktok").value;

        if (!nama || !instagram || !tiktok) {
          alert("Semua kolom wajib diisi!");
          return;
        }

        currentNama = nama;

        fetch(sheetURL, {
          method: "POST",
          body: JSON.stringify({ type: "register", nama, instagram, tiktok }),
        })
          .then((res) => res.text())
          .then(() => {
            alert("Berhasil daftar!");
            loadUsers();
          });
      }

      function markFollow(targetNama) {
        if (!currentNama) {
          currentNama = prompt("Masukkan nama kamu terlebih dahulu:");
          if (!currentNama) return;
        }

        fetch(sheetURL, {
          method: "POST",
          body: JSON.stringify({
            type: "follow",
            followerNama: currentNama,
            targetNama,
          }),
        })
          .then((res) => res.text())
          .then(() => {
            alert("Berhasil tandai sudah follow " + targetNama);
            loadUsers();
          });
      }

      function loadUsers() {
        fetch(sheetURL)
          .then((res) => res.json())
          .then((data) => {
            const div = document.getElementById("userList");
            div.innerHTML = "";

            const userMap = {};
            data.users.forEach((u) => (userMap[u.Nama] = u));

            const followCount = {};
            data.followData.forEach((fd) => {
              if (!followCount[fd[0]]) followCount[fd[0]] = 0;
              followCount[fd[0]]++;
            });

            data.users.forEach((user) => {
              const nama = user.Nama;
              div.innerHTML += `
          <div class="user-card">
            <strong>${nama}</strong><br>
            IG: <a href="https://instagram.com/${user.Instagram}" target="_blank">@${user.Instagram}</a><br>
            TikTok: <a href="https://tiktok.com/@${user.TikTok}" target="_blank">@${user.TikTok}</a><br>
            <button onclick="markFollow('${nama}')">Saya sudah follow</button>
          </div>
        `;
            });

            // Tampilkan leaderboard
            const sorted = Object.entries(followCount).sort(
              (a, b) => b[1] - a[1]
            );
            const leaderboard = document.getElementById("leaderboardList");
            leaderboard.innerHTML = sorted
              .map(
                ([nama, count], i) =>
                  `<div>${
                    i + 1
                  }. <strong>${nama}</strong> - ${count} akun difollow</div>`
              )
              .join("");
          });
      }

      loadUsers();
    </script>
  </body>
</html>
